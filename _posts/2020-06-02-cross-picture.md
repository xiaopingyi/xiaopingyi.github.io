---
layout: post
title: 前端跨域问题
categories: Javascript
description: 前端跨域
keywords: 跨域、React
---

> 之前项目中遇到一个图片跨域的问题，之前公司没有外网权限，现在将解决思路分析给大家

背景：APP下面需要分享产品给其他人，其他人识别分享出来的二维码就能够办理业务；

涉及图片：一是页面的背景图片，二是动态生成的二维码

#### 现象
在APP出现的情况是进入页面时能够访问到图片，但是在将图片通过Canvas画到画布上时用到getImageData这个属性报错显示跨域了

#### 为什么跨域
分享到微信时，微信扫一扫打开时时域名访问的，而最开始进入页面时是IP + 端口方式访问，导致跨域

#### 图片存放位置
图片没有放在项目里面，也没有放到任何服务器容器里面，就是放到和前端包同级下面的一个目录（至于为啥放这样，也不太清楚）

#### 解决思路
* 思路一：因为图片本身和项目的静态资源层级关系是一致的，于是最开始的想法是通过相对路劲去查找图片地址，但由于本地没有图片路径在编译时就会报错 -- pass

* 思路二：使用js动态创建Image标签同时设置图片允许跨域，设置属性crossOrigin = anonymous，但这个需要访问图片的服务器端支持，由于这种涉及到服务器安全，经过运维人员评估不使用此方法 --pass

* 思路三：通过中间层获取到图片的base64，前端直接负责显示即可；但中间层获取到图片时通过Ip+端口+图片路径发现图片存在的是前端项目里面的一个子目录下面，根本不是在一个文件服务下面的，所以也取不到，中间层直接读取服务器的文件获取到（中间层和前端war包在同一台服务器上），但这个方法比较low，但最终得以实现


* 优化：最终和局方商量，将图片存放在静态资源的服务


上面的解决思路是很不科学的方法，仅针对当时项目的情况，个人认为应该是把静态资源放到专门的静态资源服务器，静态资源服务器设置白名单配置前端解决资源跨域问题
